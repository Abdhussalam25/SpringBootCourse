package com.controller;

import java.io.IOException;
import java.io.PrintWriter;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.Statement;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import org.hibernate.Session;
import org.hibernate.SessionFactory;
import org.hibernate.Transaction;
import org.hibernate.cfg.Configuration;

import com.bean.Employee;



/**
 * Servlet implementation class EmployeeController
 */
@WebServlet("/EmployeeController")
public class EmployeeController extends HttpServlet {
	private static final long serialVersionUID = 1L;
       
    
    public EmployeeController() {
        super();
       
    }

    protected void doPut(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
    	
    }
	
	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		String empIds = request.getParameter("empId");
		int empId;
		if(empIds != null) {
			 empId = Integer.parseInt(empIds);	
			 System.out.println("inside if empid is" +empId);

			 try {
			        Class.forName("com.mysql.cj.jdbc.Driver");
			        Connection conn=DriverManager.getConnection("jdbc:mysql://localhost:3306/cyberinforminies_ems","root","basha");
			        Statement st=conn.createStatement();
			        
			        ResultSet rs=st.executeQuery("select * from employee where empId=" + empId); 
			        //System.out.println(rs.getInt("empId"));
			        
			       //System.out.println(rs);
			      
			        
			        int i=0;
			        PrintWriter out1 = response.getWriter();
			        
			        if(rs.next()) {
	               
			        	 out1.println("<table>");
			        	 out1.println("<thead>");
			             out1.println("<tr>");
			             out1.println("<th> S.No </th>");
			             out1.println("<th> Employee Id </th>");
			             out1.println("<th> FirstName </th>");
			             out1.println("<th> LasttName </th>");
			             out1.println("<th> Address </th>");
			             out1.println("<th> Department </th>");
			             out1.println("<th> Basic Salary </th>");
			             out1.println("<th> Gross Salary </th>");
			             out1.println("</tr>");
			             out1.println("</thead>");
						 out1.println("<tbody>");      
			        
			     
			        	
			        	i++; 
			        	//System.out.println(rs.getInt("empId"));
			        	out1.println("<tr>");
			        	//int id = rs.getInt(empId);
			        	//System.out.println("empid id" +id);
			              
			            	 			out1.println("<td>"  + i  +  "</td>" );
			            	 			out1.println("<td>" +  rs.getInt("empId")+ "</td>" );
			                        	 out1.println("<td>" +  rs.getString("empFName")+ "</td>" );
			                        	 out1.println("<td>" +  rs.getString("empLastName")+ "</td>" );
			                         	 out1.println("<td>" +  rs.getString("address")+ "</td>" );
			                          	 out1.println("<td>" +  rs.getString("department")+ "</td>" );
			                           	 out1.println("<td>" +  rs.getString("basicSalary")+ "</td>" );
			                             out1.println("<td>" +  rs.getString("grossSalary")+  "</td>" );
			                        
							 out1.println("</tr>");

			        	
			        
			     
					out1.println("</tbody>");

					out1.println("</table>");
			        }else {
			        	out1.print("<h4>The entered id is not present</h4>" );
			        }
			
		}catch(Exception e){
		      e.printStackTrace();
		      
		} 
		}
		
		
	}
	
	protected void doProcess(HttpServletRequest request, HttpServletResponse response)throws ServletException, IOException {
		
	}
	
 protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		
	
		
		PrintWriter out = response.getWriter();
		String firstName = request.getParameter("firstName");
		String lastName = request.getParameter("lastName");		
	
		String department = request.getParameter("department");
		String salaryText = request.getParameter("salary");
		String address = request.getParameter("address");
		float salary = Float.parseFloat(salaryText);	
		
		Employee employee =  new Employee(firstName,lastName,address,department,salary);
		
		
		Configuration cfg = new Configuration();
		cfg.configure("hibernate.cfg.xml"); 
		SessionFactory sessionFactory = cfg.buildSessionFactory();
		Session session = sessionFactory.openSession();	
		
		Transaction tx = session.beginTransaction();
		
		session.save(employee);

		tx.commit();
		System.out.println("\n data saved successfully");
		
//		try {
//		Class.forName("com.mysql.jdbc.Driver");			
//		Connection conn=DriverManager.getConnection("jdbc:mysql://localhost:3306/cyberinforminies_ems","root","basha");
//		Statement st=conn.createStatement();
//		//ResultSet rs=st.executeQuery("insert into employee_table values (" );
//		}catch(SQLException | ClassNotFoundException e) {
//			e.printStackTrace();
//		}
		
		out.print("    entered values are \n" + firstName + "\n"+lastName 
				+ "\n"+department + " \n" +address + " \n" +salary);
		
		response.sendRedirect("adminPage.jsp?employees=employee");
		
	}

}
